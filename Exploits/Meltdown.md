# Meltdown
## OS 101
- Kernel is isolated from userspace by both hardware and software
- R3 programs cannot bypass these protections
- Kernel is typically mapped into every address space

### Paging
- CPU supports virtual address spaces to isolate processes
- Physical memory is organized in page frames
- Virtual memory pages are mapped to page frames using page tables
- PTE contains SU bit that defines the privilege level that page can be accessed at

## Microarchitecture 101
- Instructions are 
  - Fetched (IF)
  - Decoded (ID)
  - Executed (EX)
  - Memory access is performed (MEM)
  - Architectural register file is updated (WB)
- Issues
  - If executed in order, it's slow
  - Dependencies slow the pipeline
  - Cache misses also slow

### Out-Of-Order Execution
- Instructions are
  - Fetched and decoded in the front-end
  - Dispatched to backend
  - Processed by individual execution units
- Advantages
  - Can be executed out of order
  - Needs to only wait for dependencies
- Instructions are retired in-order if they aren't used
  - Architectural state becomes visible after retirement
  - Exceptions are checked during retirement - just flush pipeline and recover state
  - It's all happening on the microarchitectural level
- They leave microarchitectural traces
  - You can see them in the cache
  - Transient instructions get executed, but they don't affect the final state

## Side channel attacks
- Information can leak due to the underlying hardware
- Unintentional leakage can be exploited by side effects
  - Power consumption
  - Execution time
  - CPU caches

### Cache attacks
- Timing cache accesses to check whether target accessed particular address

## Core attack
- Using OOO, it is possible to read data at any address
- Index of cache hit reveals data
- Permission check is in some cases not fast enough

### Preventing crash
- Handle the segfault
- Use Intel TSX
  - Created in order to replace locking
  - Has a side effect of suppressing exceptions
  - Can be further improved by NULL pointer trick

## Targeted attacks
- Dumping entire memory takes time
- You can target a specific process
- Linux manages processes in a linked list
  - Head of the list is stored at `init_task` structure
  - Each task list structure contains a pointer to the next task and its PID, name and root of multipage table

# Credits
- Daniel Gruss, Michael Schwarz and Moritz Tipp - "_[Meltdown: Basics, Details, Consequences](https://youtu.be/UTSJf05pw-0)_"

# Author
- [Harutekku](https://github.com/harutekku)